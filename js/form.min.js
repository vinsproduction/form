var Form;Form=function(){function Form(params){var self;this.params=null!=params?params:{},window.console||(window.console={}),window.console.groupCollapsed||(window.console.groupCollapsed=function(){return window.console.log?console.log.apply(console,arguments):void 0}),window.console.groupEnd||(window.console.groupEnd=function(){}),this.logs=!1,this.formName="form",this.formEl=!1,this.submitEl=!1,this.autoFields=!0,this.enter=!0,this.disableSubmit=!1,this.classes={input:{placeholder:"placeholder"},select:{open:"open",placeholder:"default"},submit:{disable:"disabled"},errorField:"error-field",error:"error",preloader:"preloader",required:"required"},this.templates={hidden:"<div style='position:absolute;width:0;height:0;overflow:hidden;'></div>",checkbox:'<div class="checkbox"></div>',radio:'<div class="radio"></div>',select:{select:'<div class="select"></div>',selected:'<div class="selected"><span>{selected}</span></div>',options:'<div class="options"></div>',option:'<div class="option"><span>{text}</span></div>'},error:"<div>{error}</div>"},this.fields={},this.fieldsOptions={active:!0,style:!0,clearErrorsInFocus:!0,autoErrors:!0,escape:!1,rules:{},onError:function(fieldName,errors){}},this.data={},this.errors={},this.onFail=function(errors){},this.onSuccess=function(data){},this.onSubmit=function(data){},this.onReset=function(){},this.onInit=function(){},$.extend(!0,this,this.params),self=this,this.validation(),$(function(){return!self.formEl&&self.logs?console.log("[Form: "+self.formName+"] Warning! formEl not set"):!self.submitEl&&self.logs?console.log("[Form: "+self.formName+"] Warning! submitEl not set"):(self.form=self.isObject(self.formEl)?self.formEl:$(self.formEl),self.submitBtn=self.isObject(self.submitEl)?self.submitEl:self.form.find(self.submitEl),!self.form.size()&&self.logs?console.log("[Form: "+self.formName+"] Warning! formEl not found in DOM"):!self.submitBtn.size()&&self.logs?console.log("[Form: "+self.formName+"] Warning! submitEl not found in DOM"):(self.form.attr("data-form",self.formName),self.submitBtn.attr("data-submit","data-submit"),self.form.mouseover(function(){return self.form.inFocus=!0}),self.form.mouseout(function(){return self.form.inFocus=!1}),self.enter&&$(window).keydown(function(event){return self.form.inFocus&&13===event.keyCode&&!self._disableSubmit?self.submit():void 0}),self.autoFields&&self.form.find("[name]").each(function(){var name;return name=$(this).attr("name"),self.params.fields&&self.params.fields[name]===!1?delete self.fields[name]:self.fields[name]=self.params.fields&&self.params.fields[name]?self.params.fields[name]:{}}),void self.init()))})}return Form.prototype.init=function(){var opts,self;self=this,this.form.find("[data-field]").off("change").off("style").off("click"),this.form.off("Style").off("Change").off("click"),this.submitBtn.off("click"),this.form.on("click","[data-field]",function(){var name;return name=$(this).attr("data-name")||$(this).attr("name"),self.fields[name]?(self.fields[name].clearErrorsInFocus&&self.errorField(name,!1),!0):void 0}),this.form.on("Style","[data-field]",function(){var el,name;return el=$(this),name=el.attr("name"),self.fields[name]?(self.errorField(name,!1),el.is("select")?self.createSelect(name):"radio"===el.attr("type")?self.createRadio(name):"checkbox"===el.attr("type")&&self.createCheckbox(name),el.trigger("style",[self.fields[name].sel]),!0):void 0}),this.form.on("Change","[data-field]",function(e,data){var el,name;return el=$(this),name=el.attr("name"),self.fields[name]?(el.is("select")?self.createSelect(name,!0):"radio"===el.attr("type")?self.createRadio(name,!0):"checkbox"===el.attr("type")&&self.createCheckbox(name,!0),self.fields[name].el.trigger("change",data),!0):void 0}),this.form.submit(function(e){return e.preventDefault()}),this.disableSubmit?this.lockSubmit():this.unlockSubmit(),this.submitBtn.click(function(){return self._disableSubmit||self.submit(),!1}),this.logs&&(opts={autoFields:this.autoFields,fields:this.fields,fieldsOptions:this.fieldsOptions,enter:this.enter,disableSubmit:this.disableSubmit,classes:this.classes},console.groupCollapsed("[Form: "+this.formName+"] init"),console.log(opts),console.groupEnd()),$.each(this.fields,function(name){return self.initField(name)}),this.onInit(),$.each(this.fields,function(name){return self.fields[name].style?self.fields[name].el.eq(0).trigger("Style"):void 0})},Form.prototype.initField=function(name){var el,ref,self;return self=this,el=this.form.find("[name='"+name+"']"),el.size()?(this.fields[name]=$.extend(!0,{},this.fieldsOptions,this.fields[name]),this.fields[name].form=this,this.fields[name].el=el,this.fields[name].sel=$([]),this.fields[name].el.attr("data-name",name),this.fields[name].el.attr("data-field","original"),this.fields[name].el.attr("type")||this.fields[name].el.attr("type","text"),this.fields[name].type=this.fields[name].el.is("select")?"select":this.fields[name].el.attr("type"),this.fields[name].el.attr("data-type",this.fields[name].type),this.fields[name].originalVal=self.getVal(name),!this.fields[name].placeholder||"text"!==(ref=this.fields[name].type)&&"textarea"!==ref&&"password"!==ref||this.placeholder(name),this.fields[name].rules.required&&this.required(name,this.fields[name].rules.required),this.fields[name].required=function(flag){self.required(name,flag)},this.fields[name].stylize=function(){self.fields[name].el.eq(0).trigger("Style")},this.fields[name].val=function(val){return null==val?self.getVal(name):void self.setVal(name,val)},this.fields[name].reset=function(){self.resetField(name)},void(this.fields[name].error=function(errors){null==errors&&(errors=!1),self.errorField(name,errors)})):void console.log("[Form: "+this.formName+"] Warning! selector '"+name+"' not found")},Form.prototype.createCheckbox=function(name,change){var $checkbox,$hiddenWrap,checkboxTemplate,self,val;self=this,checkboxTemplate=this.templates.checkbox,change?this.fields[name].val()?this.fields[name].sel.attr("data-checked","data-checked"):this.fields[name].sel.removeAttr("data-checked"):(this.form.find("[data-field='original'][data-type='checkbox'][data-name='"+name+"']").parent().attr("data-wrap")&&this.form.find("[data-field='original'][data-type='checkbox'][data-name='"+name+"']").unwrap(),this.form.find("[data-field='styled'][data-type='checkbox'][data-name='"+name+"']").remove(),val=this.fields[name].el.attr("value"),$checkbox=$(checkboxTemplate),$checkbox.attr("data-field","styled"),$checkbox.attr("data-type","checkbox"),$checkbox.attr("data-name",name),$checkbox.attr("data-value",val),this.fields[name].el.after($checkbox),this.fields[name].sel=$checkbox,$hiddenWrap=$(this.templates.hidden),$hiddenWrap.attr("data-wrap",name),this.fields[name].el.wrap($hiddenWrap),this.fields[name].el.prop("checked")&&$checkbox.attr("data-checked","data-checked"),$checkbox.on("click",function(){return self.fields[name].el.prop("checked")?self.setVal(name,!1):self.setVal(name,val)}))},Form.prototype.createRadio=function(name,change){var self;self=this,change?(this.fields[name].sel.removeAttr("data-checked"),this.fields[name].sel.filter("[data-value='"+this.fields[name].val()+"']").attr("data-checked","data-checked")):(this.form.find("[data-field='original'][data-type='radio'][data-name='"+name+"']").parent().attr("data-wrap")&&this.form.find("[data-field='original'][data-type='radio'][data-name='"+name+"']").unwrap(),this.form.find("[data-field='styled'][data-type='radio'][data-name='"+name+"']").remove(),this.fields[name].sel=$([]),this.fields[name].el.each(function(){var $hiddenWrap,$radio,el,val;return el=$(this),val=el.attr("value"),$radio=$(self.templates.radio),$radio.attr("data-field","styled"),$radio.attr("data-type","radio"),$radio.attr("data-name",name),$radio.attr("data-value",val),el.attr("checked")&&$radio.attr("data-checked","data-checked"),el.after($radio),self.fields[name].sel=self.fields[name].sel.add($radio),$hiddenWrap=$(self.templates.hidden),$hiddenWrap.attr("data-wrap",name),el.wrap($hiddenWrap),$radio.on("click",function(){return self.setVal(name,val)})}))},Form.prototype.createSelect=function(name,change){var $hiddenWrap,$options,$select,$selected,selectedTemplate,selectedText,self;self=this,change?(this.fields[name].sel.removeClass(this.classes.select.open),this.fields[name].sel.find("[data-selected]").html(this.fields[name].sel.find("[data-option][data-value='"+this.fields[name].val()+"']").html()),this.fields[name].placeholder&&this.fields[name].placeholder===this.fields[name].el.val()?this.fields[name].sel.find("[data-selected]").addClass(self.classes.select.placeholder):this.fields[name].sel.find("[data-selected]").removeClass(self.classes.select.placeholder),this.fields[name].sel.find("[data-options]").hide(),this.fields[name].sel.find("[data-option]").removeAttr("data-checked"),this.fields[name].sel.find("[data-option][data-value='"+this.fields[name].val()+"']").attr("data-checked","data-checked")):(this.form.find("[data-field='original'][data-type='select'][data-name='"+name+"']").parent().attr("data-wrap")&&this.form.find("[data-field='original'][data-type='select'][data-name='"+name+"']").unwrap(),this.form.find("[data-field='styled'][data-type='select'][data-name='"+name+"']").remove(),$select=$(this.templates.select.select),$select.attr("data-field","styled"),$select.attr("data-type","select"),$select.attr("data-name",name),selectedText=this.fields[name].el.find("option[selected]").size()?this.fields[name].el.find("option:selected").text():this.fields[name].el.find("option:first-child").text(),selectedTemplate=this.templates.select.selected.replace("{selected}",selectedText),$selected=$(selectedTemplate),$selected.attr("data-selected","data-selected"),$options=$(this.templates.select.options),$options.attr("data-options","data-options"),$options.hide(),$select.append($selected),$select.append($options),this.fields[name].el.after($select),this.fields[name].sel=$select,$hiddenWrap=$(self.templates.hidden),$hiddenWrap.attr("data-wrap",name),this.fields[name].el.wrap($hiddenWrap),this.fields[name]["native"]?($select.on("click",function(){return self.fields[name].el.focus()}),this.fields[name].el.on("blur",function(){return self.setVal(name,self.fields[name].el.val())})):$selected.on("click",function(){return $select.hasClass(self.classes.select.open)?($select.removeClass(self.classes.select.open),$options.hide()):($select.addClass(self.classes.select.open),$options.show())}),$(window).click(function(event){return $(event.target).closest($select).length||$(event.target).is($select)?void 0:($select.removeClass(self.classes.select.open),$options.hide())}),this.fields[name].placeholder&&this.fields[name].placeholder===selectedText&&$selected.addClass(self.classes.select.placeholder),this.fields[name].el.find("option").each(function(){var $option,option,text,val;return(!$(this).attr("value")||self.isEmpty($(this).attr("value")))&&$(this).attr("value",$(this).text()),val=$(this).attr("value"),text=$(this).text(),option=self.templates.select.option.replace("{text}",text),$option=$(option),$option.attr("data-option","data-option"),$option.attr("data-value",val),$(this).is(":first-child")&&$option.attr("data-checked","data-checked"),$option.on("click",function(){return self.setVal(name,$(this).attr("data-value"))}),$options.append($option)}))},Form.prototype.setVal=function(name,val){var opt,ref;this.fields[name]&&(opt=this.fields[name],"radio"===opt.type?(opt.el.prop("checked",!1),opt.el.filter("[value='"+val+"']").prop("checked",val)):"checkbox"===opt.type?opt.el.prop("checked",val):"text"===(ref=opt.type)||"password"===ref||"textarea"===ref?(opt.el.val(this.trim(val)),opt.placeholder&&opt.el.trigger("blur")):opt.el.val(val),opt.el.trigger("Change",[{name:name,val:val}]))},Form.prototype.getVal=function(name){var opt,ref,ref1,val;if(this.fields[name])return opt=this.fields[name],"checkbox"===(ref=opt.type)||"radio"===ref?val=opt.el.filter(":checked").val()||!1:"text"===(ref1=opt.type)||"password"===ref1||"textarea"===ref1?(val=this.trim(opt.el.val()),opt.placeholder&&val===opt.placeholder&&(val="")):val=opt.el.val(),val},Form.prototype.required=function(name,opt){this.fields[name]&&(opt?(this.fields[name].rules.required=opt,this.fields[name].el.addClass(this.classes.required)):(this.fields[name].rules.required=!1,this.fields[name].el.removeClass(this.classes.required)))},Form.prototype.submit=function(){var data,self;self=this,this.resetData(),this.resetErorrs(),data={},this.logs&&console.groupCollapsed("[Form: "+this.formName+"] submit"),$.each(this.fields,function(name,opt){var val;return val=self.getVal(name),opt.name?data[opt.name]=opt.escape?self.escapeText(val):val:data[name]=opt.escape?self.escapeText(val):val,opt.active?(self.setData(name,val),self.logs&&console.log(name+": "+val),self.errorField(name,!1),opt.rules&&!self.isEmpty(opt.rules)?$.each(opt.rules,function(ruleName,rule){var valid;return rule&&(valid=self.validate[ruleName](val,rule),!valid.state)?self.setError(name,valid.reason):void 0}):void 0):delete data[name]}),this.logs&&console.log("data",data),this.logs&&console.groupEnd(),this.onSubmit(data),this.isEmpty(this.errors)?this.success():this.fail()},Form.prototype.fail=function(){var self;self=this,this.logs&&console.groupCollapsed("[Form: "+this.formName+"] fail"),$.each(this.fields,function(name,opt){return self.errors[name]?(self.logs&&console.log(name+": ",self.errors[name]),self.fields[name].autoErrors&&("all"===self.fields[name].autoErrors?self.errorField(name,self.errors[name]):self.errors[name][0]&&self.errorField(name,self.errors[name][0])),opt.onError(name,self.errors[name])):void 0}),this.logs&&console.log("data",this.errors),this.logs&&console.groupEnd(),this.onFail(this.errors)},Form.prototype.success=function(){var name,ref,val;this.logs&&console.groupCollapsed("[Form: "+this.formName+"] success"),ref=this.data;for(name in ref)val=ref[name],this.logs&&console.log(name,val);this.logs&&console.log("data",this.data),this.logs&&console.groupEnd(),this.onSuccess(this.data)},Form.prototype.reset=function(){var self;self=this,this.resetData(),this.resetErorrs(),$.each(this.fields,function(name,opt){return self.fields[name]["new"]?self.removeField(name):self.fields[name].reset()}),this.logs&&console.log("[Form: "+this.formName+"] reset"),this.onReset()},Form.prototype.resetErorrs=function(){return this.errors={}},Form.prototype.resetData=function(){return this.data={}},Form.prototype.setData=function(name,val){this.data[name]||(this.data[name]=val)},Form.prototype.getData=function(){return this.data},Form.prototype.setError=function(name,val){this.errors[name]||(this.errors[name]=[]),this.errors[name].push(val)},Form.prototype.getErrors=function(){return this.errors},Form.prototype.errorField=function(name,errors){var $error,error,self;this.fields[name]&&(self=this,errors?(this.fields[name].el.addClass(this.classes.errorField),this.fields[name].sel&&this.fields[name].sel.addClass(this.classes.errorField),this.fields[name].autoErrors&&($error=this.form.find("."+this.classes.error+"-"+name),this.isArray(errors)?($error.empty(),$.each(errors,function(k,v){var error;return error=self.templates.error.replace("{error}",v),$error.append(error)})):(error=self.templates.error.replace("{error}",errors),$error.html(error)))):(this.fields[name].el.removeClass(this.classes.errorField),this.fields[name].sel&&this.fields[name].sel.removeClass(this.classes.errorField),this.fields[name].autoErrors&&this.form.find("."+this.classes.error+"-"+name).empty()))},Form.prototype.resetField=function(name){this.fields[name]&&(this.setVal(name,this.fields[name].originalVal),this.errorField(name,!1))},Form.prototype.addField=function(opt){var name;name=opt.name,this.fields[name]=opt.options||this.fieldsOptions,this.initField(name,!0),this.fields[name]["new"]=!0,opt.onInit&&opt.onInit(),this.logs&&console.log("[Form: "+this.formName+"] add field",name),this.fields[name].style&&this.fields[name].el.trigger("Style")},Form.prototype.removeField=function(name){this.fields[name]&&(this.fields[name].el.removeAttr("data-field"),this.fields[name].style&&this.fields[name].el.unwrap(),this.fields[name].sel&&this.fields[name].sel.remove(),this.logs&&console.log("[Form: "+this.formName+"] delete field",name),delete this.fields[name])},Form.prototype.placeholder=function(name){var self;this.fields[name]&&(self=this,this.fields[name].el.focus(function(){return $(this).val()===self.fields[name].placeholder?$(this).val("").removeClass(self.classes.input.placeholder):void 0}).blur(function(){return self.isEmpty($(this).val())||$(this).val()===self.fields[name].placeholder?$(this).val(self.fields[name].placeholder).addClass(self.classes.input.placeholder):$(this).removeClass(self.classes.input.placeholder)}),this.fields[name].el.blur())},Form.prototype.lockSubmit=function(){this._disableSubmit=!0,this.submitBtn.addClass(this.classes.submit.disable)},Form.prototype.unlockSubmit=function(){this._disableSubmit=!1,this.submitBtn.removeClass(this.classes.submit.disable)},Form.prototype.showPreloader=function(){this.form.find("."+this.classes.preloader).show()},Form.prototype.hidePreloader=function(){this.form.find("."+this.classes.preloader).hide()},Form.prototype.validation=function(){return this.validate={form:this,required:function(val,rule){var valid;return valid={state:""!==val&&val!==!1&&val!==rule.not,reason:rule.reason||"Обязательное поле для заполнения"}},numeric:function(val,rule){var valid;return valid={state:/^[0-9]+$/.test(val)||""===val,reason:rule.reason||"Допустимы только цифры"}},numericDash:function(val,rule){var valid;return valid={state:/^[\d\-\s]+$/.test(val)||""===val,reason:rule.reason||"Допустимы только цифры и подчеркивания"}},alpha:function(val,rule){var valid;return valid={state:/^[a-zа-я]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только буквы"}},eng:function(val,rule){var valid;return valid={state:/^[a-z]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только английские буквы"}},cyrillic:function(val,rule){var valid;return valid={state:/^[а-я]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только русские буквы"}},alphaDash:function(val,rule){var valid;return valid={state:/^[a-z0-9_\-]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только буквы и подчеркивания"}},alphaNumeric:function(val,rule){var valid;return valid={state:/^[a-z0-9]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только буквы и цифры"}},max:function(val,rule){var valid;return rule.reason&&(rule.reason=rule.reason.replace(/\{count\}/g,rule.count)),valid={state:val.length<=(rule.count||rule)||""===val,reason:rule.reason||"Максимум "+(rule.count||rule)+" "+this.form.declOfNum(rule.count||rule,["символ","символа","символов"])}},min:function(val,rule){var valid;return rule.reason&&(rule.reason=rule.reason.replace(/\{count\}/g,rule.count)),valid={state:val.length>=(rule.count||rule)||""===val,reason:rule.reason||"Минимум "+(rule.count||rule)+" "+this.form.declOfNum(rule.count||rule,["символ","символа","символов"])}},email:function(val,rule){var valid;return valid={state:/^[a-zA-Z0-9.!#$%&amp;'*+\-\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/.test(val)||""===val,reason:rule.reason||"Неправильно заполненный E-mail"}},url:function(val,rule){var valid;return valid={state:/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(val)||""===val,reason:rule.reason||"Неправильно заполненный url"}},compare:function(val,rule){var valid;return rule.form=this.form,valid={state:val===(this.form.isFunction(rule.val)?rule.val():rule.val),reason:rule.reason||"Поля не совпадают"}}}},Form.prototype.addRule=function(opt){return this.fields[opt.field].rules[opt.rule]=opt.reason,this.validate[opt.rule]=function(val,args,description){var valid;return valid={state:opt.condition(val)||""===val,reason:opt.reason||"custom reason"}},console.log("[Form: "+this.formName+"] add rule",opt)},Form.prototype.trim=function(text){return null==text&&(text=""),this.isString(text)?text.replace(/^\s+|\s+$/g,""):text},Form.prototype.stripHTML=function(text){return null==text&&(text=""),this.isString(text)?text.replace(/<(?:.|\s)*?>/g,""):text},Form.prototype.escapeText=function(text){return null==text&&(text=""),this.isString(text)?text.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):text},Form.prototype.isFunction=function(obj){return"[object Function]"===Object.prototype.toString.call(obj)},Form.prototype.isString=function(obj){return"[object String]"===Object.prototype.toString.call(obj)},Form.prototype.isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},Form.prototype.isObject=function(obj){return"[object Object]"===Object.prototype.toString.call(obj)},Form.prototype.isEmpty=function(o){var i;if(this.isString(o))return""===this.trim(o)?!0:!1;if(this.isArray(o))return 0===o.length?!0:!1;if(this.isObject(o)){for(i in o)if(o.hasOwnProperty(i))return!1;return!0}},Form.prototype.declOfNum=function(number,titles){var cases;return cases=[2,0,1,1,1,2],titles[number%100>4&&20>number%100?2:cases[5>number%10?number%10:5]]},Form}();