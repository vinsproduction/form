var Form,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};window.console||(window.console={}),window.console.log||(window.console.log=function(){}),window.console.groupCollapsed||(window.console.groupCollapsed=window.console.log),window.console.groupEnd||(window.console.groupEnd=function(){}),Form=function(){function Form(params){var self;this.params=null!=params?params:{},this.logs=!0,this.formName="form",this.formEl=!1,this.submitEl=!1,this.autoFields=!0,this.enter=!0,this.noSubmitEmpty=!1,this.disableSubmit=!1,this.fieldsOptions={active:!0,style:!0,autoErrors:!0,escape:!0,clearErrorsOnClick:!0,validateOnKeyup:!1,errorGroup:!1,fieldGroup:!1,attrs:{},rules:{}},this.classes={input:{placeholder:"placeholder"},checkbox:"checkbox",radio:"radio",select:{select:"select",selected:"selected",options:"options",option:"option",open:"open",placeholder:"default"},submit:{disable:"disabled"},errorField:"error-field",error:"error",preloader:"preloader",validation:"valid"},this.templates={hidden:"<div style='position:absolute;width:0;height:0;overflow:hidden;'></div>",checkbox:"<div></div>",radio:"<div></div>",select:{select:"<div></div>",selected:"<div><span>{selected}</span></div>",options:"<div></div>",option:"<div><span>{text}</span></div>"},error:"<div>{error}</div>"},this.fields={},this.data={},this.errors={},this.onFail=function(errors){},this.onSuccess=function(data){},this.onSubmit=function(data){},this.onReset=function(){},this.onInit=function(){},this.mobileBrowser=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),$.extend(!0,this,this.params),self=this,$(function(){return!self.formEl&&self.logs?console.log("[Form: "+self.formName+"] Warning! formEl not set"):!self.submitEl&&self.logs?console.log("[Form: "+self.formName+"] Warning! submitEl not set"):(self.form=self.h.isObject(self.formEl)?self.formEl:$(self.formEl),self.submitBtn=self.h.isObject(self.submitEl)?self.submitEl:self.form.find(self.submitEl),!self.form.size()&&self.logs?console.log("[Form: "+self.formName+"] Warning! formEl not found in DOM"):!self.submitBtn.size()&&self.logs?console.log("[Form: "+self.formName+"] Warning! submitEl not found in DOM"):(self.form.attr("data-form",self.formName),self.submitBtn.attr("data-submit","data-submit"),self.autoFields&&self.form.find("[name]").each(function(){var name;return name=$(this).attr("name"),self.params.fields&&self.params.fields[name]===!1?delete self.fields[name]:self.fields[name]=self.params.fields&&self.params.fields[name]?self.params.fields[name]:{}}),void self.init()))})}return Form.prototype.init=function(){var opts,self;self=this,this.resetData(),this.clearErrors(),this.resetErrors(),this.form.find("[data-field]").off(),this.form.off(),this.submitBtn.off(),this.form.on("click","[data-field]",function(){var el,name,val;return el=$(this),name=el.attr("data-name")||el.attr("name"),self.fields[name]?(val=self.getVal(name),self.fields[name].clearErrorsOnClick&&(self.deleteError(name),self.errorField(name,!1)),el.trigger("Click",{name:name,val:val,errors:self.errors[name]||[]}),!0):void 0}),this.form.on("keyup","[data-field]",function(){var el,name,val;return el=$(this),name=el.attr("data-name")||el.attr("name"),self.fields[name]?(val=self.getVal(name),self.fields[name].validateOnKeyup&&self.validateField(name,"keyup"),el.trigger("Keyup",{name:name,val:val,errors:self.errors[name]||[]}),!0):void 0}),this.form.on("style","[data-field]",function(){var el,name;return el=$(this),name=el.attr("name"),self.fields[name]?(el.is("select")?self.createSelect(name):"radio"===el.attr("type")?self.createRadio(name):"checkbox"===el.attr("type")&&self.createCheckbox(name),self.fields[name].sel.size()&&el.trigger("Style",{name:name,sel:self.fields[name].sel}),!0):void 0}),this.form.on("change","[data-field]",function(e,data,withoutTrigger){var el,name,val;return el=$(this),name=el.attr("name"),self.fields[name]?(val=self.getVal(name),self.validateField(name,"change"),self.setData(name,val),el.is("select")?self.createSelect(name,!0):"radio"===el.attr("type")?self.createRadio(name,!0):"checkbox"===el.attr("type")&&self.createCheckbox(name,!0),withoutTrigger||el.trigger("Change",{name:name,val:val,errors:self.errors[name]||[]}),!0):void 0}),this.form.on("error","[data-field]",function(e,errors){var el,name,val;return el=$(this),name=el.attr("name"),self.fields[name]?(val=self.getVal(name),el.trigger("Error",{name:name,val:val,errors:errors||[]}),!0):void 0}),this.form.on("reset","[data-field]",function(){var el,name;return el=$(this),name=el.attr("name"),self.fields[name]?(el.trigger("Reset",{name:name}),!0):void 0}),this.form.submit(function(e){return e.preventDefault()}),this.disableSubmit?this.submit(!1):this.submit(!0),this.form.mouseover(function(){return self.form.inFocus=!0}),this.form.mouseout(function(){return self.form.inFocus=!1}),this.enter&&$(window).keydown(function(event){return self.form.inFocus&&13===event.keyCode&&!self._disableSubmit?self.Submit():void 0}),this.submitBtn.click(function(){return self._disableSubmit||self.Submit(),!1}),this.logs&&(opts={autoFields:this.autoFields,fields:this.fields,fieldsOptions:this.fieldsOptions,enter:this.enter,disableSubmit:this.disableSubmit,classes:this.classes},console.groupCollapsed("[Form: "+this.formName+"] init"),console.log(opts),console.groupEnd()),$.each(this.fields,function(name){return self.initField(name)}),this.onInit(),$.each(this.fields,function(name){return self.fields[name].style?self.fields[name].el.eq(0).trigger("style"):void 0}),this.validation.init(this)},Form.prototype.initField=function(name){var el,ref,self;return self=this,el=this.form.find("[name='"+name+"']"),el.size()?(this.fields[name]=$.extend(!0,{},this.fieldsOptions,this.fields[name]),this.fields[name].form=this,this.fields[name].el=el,this.fields[name].sel=$([]),this.fields[name].el.attr("data-name",name),this.fields[name].el.attr("data-field","original"),this.fields[name].el.attr("type")||this.fields[name].el.attr("type","text"),this.fields[name].type=this.fields[name].el.is("select")?"select":this.fields[name].el.attr("type"),this.fields[name].el.attr("data-type",this.fields[name].type),this.fields[name].originalVal=self.getVal(name),"select"===this.fields[name].type&&(this.fields[name].mobileKeyboard=!0),("text"===(ref=this.fields[name].type)||"textarea"===ref||"password"===ref)&&this.fields[name].placeholder&&this.placeholder(name),this.fields[name].rules.required&&(this.fields[name]._required=this.fields[name].rules.required),$.each(this.fields[name].attrs,function(name,val){return el.attr(name,val)}),$.each(this.fields[name].rules,function(ruleName,rule){return self.validation[ruleName]?void 0:self.addFieldRule(name,ruleName,rule)}),this.fields[name].val=function(val){return null!=val?(self.setVal(name,val),this):self.getVal(name)},this.fields[name].activate=function(flag){return null==flag&&(flag=!0),self.activate(name,flag),this},this.fields[name].require=function(opt){return null==opt&&(opt={}),self.require(name,opt),this},this.fields[name].stylize=function(){return self.fields[name].el.eq(0).trigger("style"),this},this.fields[name].reset=function(){return self.resetField(name),this},this.fields[name].error=function(errors){return null==errors&&(errors=!1),self.errorField(name,errors),this},this.fields[name].validate=function(ruleName,opt){var valid;return null==opt&&(opt={}),self.validation[ruleName]?valid=self.validation[ruleName](self.getVal(name),opt):void 0},void(this.fields[name].addRule=function(ruleName,rule){return self.addFieldRule(name,ruleName,rule),this})):void console.log("[Form: "+this.formName+"] Warning! selector '"+name+"' not found")},Form.prototype.Submit=function(){var list,self;self=this,this.resetData(),this.resetErrors(),list={},this.logs&&console.groupCollapsed("[Form: "+this.formName+"] submit"),$.each(this.fields,function(name,opt){var ref,val;if(opt.active)return val=self.getVal(name),self.setData(name,val),list[name]=val,self.logs&&console.log(name+": "+(val||'""')),self.data[name]=opt.escape?self.h.escapeText(val):val,self.noSubmitEmpty&&("select"===opt.type&&opt.rules.required.not&&(self.h.isArray(opt.rules.required.not)?indexOf.call(opt.rules.required.not,val)>=0&&self.deleteData(name):val===opt.rules.required.not&&self.deleteData(name)),("text"===(ref=opt.type)||"password"===ref||"textarea"===ref)&&self.h.isEmpty(val)&&self.deleteData(name)),opt.fieldGroup&&self.data.hasOwnProperty(name)?(self.data[opt.fieldGroup]||(self.data[opt.fieldGroup]={}),self.data[opt.fieldGroup][name]=self.data[name],self.deleteData(name)):void 0}),this.logs&&console.log(this.data),this.logs&&console.groupEnd(),$.each(this.fields,function(name,opt){return opt.active?self.validateField(name):void 0}),this.onSubmit(this.data,list),this.h.isEmpty(this.errors)?this.Success(list):this.Fail()},Form.prototype.Fail=function(){var self;self=this,this.logs&&console.groupCollapsed("[Form: "+this.formName+"] fail"),$.each(this.fields,function(name,opt){var errors;return errors=self.errors[name],errors&&(self.logs&&console.log(name+": "+errors[0].reason),opt.errorGroup&&self.errors.hasOwnProperty(name))?(self.errors[opt.errorGroup]||(self.errors[opt.errorGroup]={}),self.errors[opt.errorGroup][name]=errors,self.deleteError(name)):void 0}),this.logs&&console.log(this.errors),this.logs&&console.groupEnd(),this.onFail(this.errors)},Form.prototype.Success=function(list){this.logs&&console.groupCollapsed("[Form: "+this.formName+"] success"),$.each(this.data,function(name,val){return self.logs?console.log(name+": "+(val||'""')):void 0}),this.logs&&console.log(this.data),this.logs&&console.groupEnd(),this.onSuccess(this.data,list)},Form.prototype.createCheckbox=function(name,change){var $checkbox,$hiddenWrap,checkboxTemplate,self,val;self=this,checkboxTemplate=this.templates.checkbox,change?this.fields[name].val()?this.fields[name].sel.attr("data-checked","data-checked"):this.fields[name].sel.removeAttr("data-checked"):(this.form.find("[data-field='original'][data-type='checkbox'][data-name='"+name+"']").parent().attr("data-wrap")&&this.form.find("[data-field='original'][data-type='checkbox'][data-name='"+name+"']").unwrap(),this.form.find("[data-field='styled'][data-type='checkbox'][data-name='"+name+"']").remove(),val=this.fields[name].el.attr("value"),$checkbox=$(checkboxTemplate),$checkbox.addClass(this.classes.checkbox),$checkbox.attr("data-field","styled"),$checkbox.attr("data-type","checkbox"),$checkbox.attr("data-name",name),$checkbox.attr("data-value",val),this.fields[name].el.after($checkbox),this.fields[name].sel=$checkbox,$hiddenWrap=$(this.templates.hidden),$hiddenWrap.attr("data-wrap",name),this.fields[name].el.wrap($hiddenWrap),this.fields[name].el.prop("checked")&&$checkbox.attr("data-checked","data-checked"),$checkbox.on("click",function(){return self.fields[name].el.prop("checked")?self.setVal(name,!1):self.setVal(name,val)}))},Form.prototype.createRadio=function(name,change){var self;self=this,change?(this.fields[name].sel.removeAttr("data-checked"),this.fields[name].sel.filter("[data-value='"+this.fields[name].val()+"']").attr("data-checked","data-checked")):(this.form.find("[data-field='original'][data-type='radio'][data-name='"+name+"']").parent().attr("data-wrap")&&this.form.find("[data-field='original'][data-type='radio'][data-name='"+name+"']").unwrap(),this.form.find("[data-field='styled'][data-type='radio'][data-name='"+name+"']").remove(),this.fields[name].sel=$([]),this.fields[name].el.each(function(){var $hiddenWrap,$radio,el,val;return el=$(this),val=el.attr("value"),$radio=$(self.templates.radio),$radio.addClass(self.classes.radio),$radio.attr("data-field","styled"),$radio.attr("data-type","radio"),$radio.attr("data-name",name),$radio.attr("data-value",val),el.attr("checked")&&$radio.attr("data-checked","data-checked"),el.after($radio),self.fields[name].sel=self.fields[name].sel.add($radio),$hiddenWrap=$(self.templates.hidden),$hiddenWrap.attr("data-wrap",name),el.wrap($hiddenWrap),$radio.on("click",function(){return self.setVal(name,val)})}))},Form.prototype.createSelect=function(name,change){var $hiddenWrap,$options,$select,$selected,selectedTemplate,selectedText,self;self=this,change?(this.fields[name].sel.removeClass(this.classes.select.open),this.fields[name].sel.find("[data-selected]").html(this.fields[name].sel.find("[data-option][data-value='"+this.fields[name].val()+"']").html()),this.fields[name].placeholder&&this.fields[name].placeholder===this.fields[name].el.val()?this.fields[name].sel.find("[data-selected]").addClass(self.classes.select.placeholder):this.fields[name].sel.find("[data-selected]").removeClass(self.classes.select.placeholder),this.fields[name].sel.find("[data-options]").hide(),this.fields[name].sel.find("[data-option]").removeAttr("data-checked"),this.fields[name].sel.find("[data-option][data-value='"+this.fields[name].val()+"']").attr("data-checked","data-checked")):(this.form.find("[data-field='original'][data-type='select'][data-name='"+name+"']").parent().attr("data-wrap")&&this.form.find("[data-field='original'][data-type='select'][data-name='"+name+"']").unwrap(),this.form.find("[data-field='styled'][data-type='select'][data-name='"+name+"']").remove(),$select=$(this.templates.select.select),$select.addClass(this.classes.select.select),$select.attr("data-field","styled"),$select.attr("data-type","select"),$select.attr("data-name",name),selectedText=this.fields[name].el.find("option[selected]").size()?this.fields[name].el.find("option:selected").text():this.fields[name].el.find("option:first-child").text(),selectedTemplate=this.templates.select.selected.replace("{selected}",selectedText),$selected=$(selectedTemplate),$selected.addClass(this.classes.select.selected),$selected.attr("data-selected","data-selected"),$options=$(this.templates.select.options),$options.addClass(this.classes.select.options),$options.attr("data-options","data-options"),$options.hide(),$select.append($selected),$select.append($options),this.fields[name].el.after($select),this.fields[name].sel=$select,$hiddenWrap=$(self.templates.hidden),$hiddenWrap.attr("data-wrap",name),this.fields[name].el.wrap($hiddenWrap),this.fields[name].mobileKeyboard&&this.mobileBrowser?($select.on("click",function(){return self.fields[name].el.focus()}),this.fields[name].el.on("blur",function(){return self.setVal(name,self.fields[name].el.val())})):$selected.on("click",function(){return $select.hasClass(self.classes.select.open)?($select.removeClass(self.classes.select.open),$options.hide()):($select.addClass(self.classes.select.open),$options.show())}),$(window).click(function(event){return $(event.target).closest($select).length||$(event.target).is($select)?void 0:($select.removeClass(self.classes.select.open),$options.hide())}),this.fields[name].placeholder&&this.fields[name].placeholder===selectedText&&$selected.addClass(self.classes.select.placeholder),this.fields[name].el.find("option").each(function(){var $option,option,text,val;return(!$(this).attr("value")||self.h.isEmpty($(this).attr("value")))&&$(this).attr("value",$(this).text()),val=$(this).attr("value"),text=$(this).text(),option=self.templates.select.option.replace("{text}",text),$option=$(option),$option.addClass(self.classes.select.option),$option.attr("data-option","data-option"),$option.attr("data-value",val),$(this).is(":first-child")&&$option.attr("data-checked","data-checked"),$option.on("click",function(){return self.setVal(name,$(this).attr("data-value"))}),$options.append($option)}))},Form.prototype.validateField=function(name,event){var ref,self,showErrors,val;if(this.fields[name]&&this.fields[name].rules&&!this.h.isEmpty(this.fields[name].rules)&&(self=this,val=self.getVal(name),self.deleteError(name),self.errorField(name,!1),self.fields[name].el.removeClass(self.classes.validation),self.fields[name].sel.removeClass(self.classes.validation),showErrors=!0,self.fields[name].rules.required||!self.h.isEmpty(val)))return("keyup"===event||"change"===event)&&("checkbox"===(ref=self.fields[name].type)||"radio"===ref?val===!1&&(showErrors=!1):"select"===self.fields[name].type?self.fields[name].rules.required&&self.fields[name].rules.required.not&&(self.h.isArray(self.fields[name].rules.required.not)?indexOf.call(self.fields[name].rules.required.not,val)>=0&&(showErrors=!1):val===self.fields[name].rules.required.not&&(showErrors=!1)):self.h.isEmpty(val)&&(showErrors=!1)),$.each(self.fields[name].rules,function(ruleName,rule){var valid;if(rule&&self.validation[ruleName]&&(valid=self.validation[ruleName](val,rule),!valid.state&&(self.setError(name,{ruleName:ruleName,reason:valid.reason}),showErrors&&self.fields[name].autoErrors))){if("all"===self.fields[name].autoErrors)return self.errorField(name,self.errors[name]);if(self.errors[name][0])return self.errorField(name,self.errors[name][0])}}),!showErrors||self.errors[name]&&!self.h.isEmpty(self.errors[name])?void 0:(self.fields[name].el.addClass(self.classes.validation),self.fields[name].sel.addClass(self.classes.validation))},Form.prototype.setVal=function(name,val,withoutTrigger){var opt,ref;null==withoutTrigger&&(withoutTrigger=!1),this.fields[name]&&(opt=this.fields[name],"radio"===opt.type?(opt.el.prop("checked",!1),opt.el.filter("[value='"+val+"']").prop("checked",val)):"checkbox"===opt.type?opt.el.prop("checked",val):"text"===(ref=opt.type)||"password"===ref||"textarea"===ref?(opt.el.val(this.h.trim(val)),opt.placeholder&&opt.el.trigger("blur")):opt.el.val(val),opt.el.eq(0).trigger("change",[{name:name,val:val},withoutTrigger]))},Form.prototype.getVal=function(name){var opt,ref,ref1,val;if(this.fields[name])return opt=this.fields[name],val="checkbox"===(ref=opt.type)||"radio"===ref?opt.el.filter(":checked").val()||!1:"text"===(ref1=opt.type)||"password"===ref1||"textarea"===ref1?opt.el.hasClass(this.classes.input.placeholder)?"":this.h.trim(opt.el.val()):opt.el.val()},Form.prototype.reset=function(){var self;self=this,this.resetData(),this.resetErrors(),$.each(this.fields,function(name,opt){return self.fields[name]["new"]?self.removeField(name):self.fields[name].reset()}),this.logs&&console.log("[Form: "+this.formName+"] reset"),this.onReset()},Form.prototype.resetErrors=function(){return this.errors={}},Form.prototype.resetData=function(){return this.data={}},Form.prototype.setData=function(name,val){this.data[name]=val},Form.prototype.deleteData=function(name){delete this.data[name]},Form.prototype.getData=function(){return this.data},Form.prototype.setError=function(name,opt){this.errors[name]||(this.errors[name]=[]),this.errors[name].push(opt)},Form.prototype.deleteError=function(name){delete this.errors[name]},Form.prototype.getErrors=function(){return this.errors},Form.prototype.clearErrors=function(){var self;self=this,this.form.find("."+this.classes.error).empty(),this.form.find("[data-field]").removeClass(this.classes.errorField)},Form.prototype.errorField=function(name,errors,withoutTrigger){var $error,error,self;this.fields[name]&&(self=this,errors?(this.fields[name].errorGroup?$.each(this.fields,function(fieldName){return self.fields[fieldName].errorGroup===self.fields[name].errorGroup?(self.fields[fieldName].el.addClass(self.classes.errorField),self.fields[fieldName].sel.addClass(self.classes.errorField)):void 0}):(this.fields[name].el.addClass(this.classes.errorField),this.fields[name].sel.addClass(this.classes.errorField)),this.fields[name].autoErrors&&($error=this.fields[name].errorGroup?this.form.find("."+this.classes.error+"-"+this.fields[name].errorGroup):this.form.find("."+this.classes.error+"-"+name),this.h.isArray(errors)?($error.empty(),$.each(errors,function(k,v){var error;return self.h.isObject(v)||(v={reason:v}),error=self.templates.error.replace("{error}",v.reason),$error.append(error)})):(self.h.isObject(errors)||(errors={reason:errors}),error=self.templates.error.replace("{error}",errors.reason),$error.html(error))),withoutTrigger||self.fields[name].el.eq(0).trigger("error",[errors])):(this.fields[name].errorGroup?$.each(this.fields,function(fieldName){return self.fields[fieldName].errorGroup===self.fields[name].errorGroup?(self.fields[fieldName].el.removeClass(self.classes.errorField),self.fields[fieldName].sel.removeClass(self.classes.errorField)):void 0}):(this.fields[name].el.removeClass(this.classes.errorField),this.fields[name].sel.removeClass(this.classes.errorField)),this.fields[name].autoErrors&&(this.fields[name].errorGroup?this.form.find("."+this.classes.error+"-"+this.fields[name].errorGroup).empty():this.form.find("."+this.classes.error+"-"+name).empty())))},Form.prototype.resetField=function(name){this.fields[name]&&(this.setVal(name,this.fields[name].originalVal,!0),this.errorField(name,!1),this.fields[name].el.eq(0).trigger("reset"))},Form.prototype.addField=function(name,opt){this.fields[name]=opt,this.initField(name,!0),this.validation.init(this),this.fields[name]["new"]=!0,opt.onInit&&opt.onInit(),this.logs&&console.log("[Form: "+this.formName+"] add field",name),this.fields[name].style&&this.fields[name].el.trigger("style")},Form.prototype.removeField=function(name){this.fields[name]&&(this.fields[name].el.removeAttr("data-field"),this.fields[name].style&&this.fields[name].el.unwrap(),this.fields[name].sel&&this.fields[name].sel.remove(),this.logs&&console.log("[Form: "+this.formName+"] delete field",name),delete this.fields[name])},Form.prototype.require=function(name,opt){this.fields[name]&&(opt&&this.fields[name]._required?this.fields[name].rules.required=this.fields[name]._required:this.fields[name].rules.required=opt)},Form.prototype.newRule=function(name,rule){this.validation[name]=function(val){var obj,valid;return obj={state:!1,reason:rule.reason||"unknown reason"},(valid=function(){return rule.condition(val)&&(obj.state=!0),obj})()}},Form.prototype.addFieldRule=function(name,ruleName,rule){null==rule&&(rule={}),this.fields[name]&&ruleName&&(!this.validation[ruleName]&&rule.condition&&this.newRule(ruleName,rule),this.fields[name].rules[ruleName]=rule,this.logs&&console.log("[Form: "+this.formName+"] add rule '"+ruleName+"'"))},Form.prototype.activate=function(name,flag){this.fields[name]&&(this.fields[name].active=flag)},Form.prototype.placeholder=function(name){var self;this.fields[name]&&(self=this,this.fields[name].el.focus(function(){return $(this).hasClass(self.classes.input.placeholder)?$(this).val("").removeClass(self.classes.input.placeholder):void 0}).blur(function(){return self.h.isEmpty($(this).val())?$(this).val(self.fields[name].placeholder).addClass(self.classes.input.placeholder):$(this).removeClass(self.classes.input.placeholder)}),this.fields[name].el.blur())},Form.prototype.submit=function(flag){null==flag&&(flag=!0),flag?(this._disableSubmit=!1,this.submitBtn.removeClass(this.classes.submit.disable)):(this._disableSubmit=!0,this.submitBtn.addClass(this.classes.submit.disable))},Form.prototype.preloader=function(flag){var preloader;null==flag&&(flag=!0),preloader=this.form.find("."+this.classes.preloader),flag?preloader.show():preloader.hide()},Form.prototype.h={trim:function(text){return null==text&&(text=""),this.isString(text)?text.replace(/^\s+|\s+$/g,""):text},stripHTML:function(text){return null==text&&(text=""),this.isString(text)?text.replace(/<(?:.|\s)*?>/g,""):text},escapeText:function(text){return null==text&&(text=""),this.isString(text)?text.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):text},isFunction:function(obj){return"[object Function]"===Object.prototype.toString.call(obj)},isString:function(obj){return"[object String]"===Object.prototype.toString.call(obj)},isArray:function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},isObject:function(obj){return"[object Object]"===Object.prototype.toString.call(obj)},isEmpty:function(o){var i;if(this.isString(o))return""===this.trim(o)?!0:!1;if(this.isArray(o))return 0===o.length?!0:!1;if(this.isObject(o)){for(i in o)if(o.hasOwnProperty(i))return!1;return!0}},declOfNum:function(number,titles){var cases;return cases=[2,0,1,1,1,2],titles[number%100>4&&20>number%100?2:cases[5>number%10?number%10:5]]}},Form.prototype.validation={init:function(form){return this.form=$.extend(!0,{},this,form)},patterns:{numeric:{exp:"0-9",type:["цифра","цифры","цифр","цифры"]},alpha:{exp:"а-яёА-ЯЁa-zA-Z",type:["буква","буквы","букв","буквы"]},rus:{exp:"а-яёА-ЯЁ",type:["русская буква","русские буквы","русских букв","русские буквы"]},rusLowercase:{exp:"а-яё",type:["русская маленькая буква","русские маленькой буквы","русских маленьких букв","русские маленькой буквы"]},rusUppercase:{exp:"А-ЯЁ",type:["русская большая буква","русские большие буквы","русских больших букв","русские большие буквы"]},eng:{exp:"a-zA-Z",type:["английская буква","английские буквы","английских букв","английские буквы"]},engLowercase:{exp:"a-z",type:["английская маленькая буква","английские маленькие буквы","английских маленьких букв","английские маленькие буквы"]},engUppercase:{exp:"A-Z",type:["английская большая буква","английские большие буквы","английских больших букв","английские большие буквы"]},dot:{exp:".",type:["точка","точки","точек","точки"]},hyphen:{exp:"-",type:["дефис","дефиса","дефисов","дефисы"]},dash:{exp:"_",type:["подчеркивание","подчеркивания","подчеркиваний","подчеркивания"]},space:{exp:"\\s",type:["пробел","пробела","пробелов","пробелы"]},slash:{exp:"\\/",type:["слэш","слэша","слэшей","слэшы"]},comma:{exp:",",type:["запятая","запятой","запятых","запятые"]},special:{exp:"$@$!%*#?&",type:["специальный символ","специальных символа","специальных символов","специальныe символы"]}},required:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Обязательное поле для заполнения"},(valid=function(){return val!==!1&&(rule.not?self.h.isArray(rule.not)?null!=val&&!self.h.isEmpty(val)&&indexOf.call(rule.not,val)<0&&(obj.state=!0):null==val||self.h.isEmpty(val)||val===rule.not||(obj.state=!0):null==val||self.h.isEmpty(val)||(obj.state=!0)),obj})()},numeric:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Допустимы только цифры"},(valid=function(){return/^[0-9]+$/.test(val)&&(obj.state=!0),obj})()},alpha:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Допустимы только буквы"},(valid=function(){return/^[a-zA-Zа-яёА-ЯЁ]+$/.test(val)&&(obj.state=!0),obj})()},eng:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Допустимы только английские буквы"},(valid=function(){return/^[a-zA-Z]+$/.test(val)&&(obj.state=!0),obj})()},rus:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Допустимы только русские буквы"},(valid=function(){return/^[а-яёА-ЯЁ]+$/.test(val)&&(obj.state=!0),obj})()},max:function(val,rule){var count,obj,self,valid;return self=this.form,obj={state:!1},count=rule.count||rule,rule.reason?obj.reason=rule.reason.replace(/\{count\}/g,rule.count):obj.reason="Максимум "+count+" "+self.h.declOfNum(count,["символ","символа","символов"]),(valid=function(){return val.length<=count&&(obj.state=!0),obj})()},min:function(val,rule){var count,obj,self,valid;return self=this.form,obj={state:!1},count=rule.count||rule,rule.reason?obj.reason=rule.reason.replace(/\{count\}/g,rule.count):obj.reason="Минимум "+count+" "+self.h.declOfNum(count,["символ","символа","символов"]),(valid=function(){return val.length>=count&&(obj.state=!0),obj})()},email:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Неправильно заполненный E-mail"},(valid=function(){return/^[a-zA-Z0-9.!#$%&amp;'*+\-\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/.test(val)&&(obj.state=!0),obj})()},url:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Неправильно заполненный url"},(valid=function(){return/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(val)&&(obj.state=!0),obj})()},not:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Недопустимое значение"},(valid=function(){return null!=rule.val?self.h.isArray(rule.val)&&(indexOf.call(rule.val,val)<0?obj.state=!0:val!==rule.val&&(obj.state=!0)):self.h.isArray(rule)?indexOf.call(rule,val)<0&&(obj.state=!0):val!==rule&&(obj.state=!0),obj})()},compare:function(val,rule){var obj,self,valid;return self=this.form,obj={state:!1,reason:rule.reason||"Поля не совпадают"},(valid=function(){return rule.field&&self.fields[rule.field]?(rule.reason?obj.reason=rule.reason.replace(/\{field\}/g,rule.field):obj.reason="Поле не совпадает с "+rule.field,val===self.fields[rule.field].val()&&(obj.state=!0),obj):rule.val?(self.h.isFunction(rule.val)?val===rule.val()&&(obj.state=!0):val===rule.val&&(obj.state=!0),obj):void 0})()},only:function(val,rule){var obj,patterns,self,valid;return self=this.form,patterns=this.patterns,obj={state:!0},rule.reason&&(obj.reason=rule.reason),(valid=function(){var _patterns,_reasons,maxmin,pattern,range,reason;return _patterns=[],_reasons=[],$.each(rule.exp,function(k,v){return patterns[k]?(_reasons.push(patterns[k].type[3]),_patterns.push(patterns[k].exp)):void 0}),reason=_reasons.join(", "),pattern=_patterns.join(""),pattern="^["+pattern+"]+$",rule.reason||(obj.reason="Допустимы только "+reason),new RegExp(pattern).test(val)?(_reasons=[],range=!0,$.each(rule.exp,function(k,v){if("range"===k&&self.h.isArray(v)){if(v[0]&&val.length<v[0])return _reasons.push("минимум "+v[0]+" "+self.h.declOfNum(v[0],["символ","символа","символов"])),range=!1,!1;if(v[1]&&val.length>v[1])return _reasons.push("максимум "+v[1]+" "+self.h.declOfNum(v[1],["символ","символа","символов"])),range=!1,!1}}),range?(_reasons=[],maxmin=!0,$.each(rule.exp,function(k,v){var match,reg;if(patterns[k]&&self.h.isArray(v)){if(reg=new RegExp("["+patterns[k].exp+"]","g"),match=val.match(reg),v[0]){if(match&&match.length<v[0])return _reasons.push("Допустимы минимум "+v[0]+" "+self.h.declOfNum(v[0],patterns[k].type)),maxmin=!1,!1;if(!match)return _reasons.push("Требуется минимум "+v[0]+" "+self.h.declOfNum(v[0],patterns[k].type)),maxmin=!1,!1}if(v[1]&&match&&match.length>v[1])return _reasons.push("Допустимы максимум "+v[1]+" "+self.h.declOfNum(v[1],patterns[k].type)),maxmin=!1,!1}}),maxmin?obj:(reason=_reasons.join(", "),rule.reason||(obj.reason=reason),obj.state=!1,obj)):(reason=_reasons.join(", "),rule.reason||(obj.reason="Допустимы "+reason),obj.state=!1,obj)):(obj.state=!1,obj)})()},strict:function(val,rule){var obj,patterns,self,valid;return self=this.form,patterns=this.patterns,obj={state:!0},rule.reason&&(obj.reason=rule.reason),(valid=function(){var _patterns,_reasons,maxmin,pattern,range,reason;return _patterns=[],_reasons=[],$.each(rule.exp,function(k,v){return patterns[k]?(_reasons.push(patterns[k].type[3]),_patterns.push("(?=.*["+patterns[k].exp+"])")):void 0}),reason=_reasons.join(", "),pattern=_patterns.join(""),rule.reason||(obj.reason="Требуется "+reason),new RegExp(pattern).test(val)?(_reasons=[],range=!0,$.each(rule.exp,function(k,v){if("range"===k&&self.h.isArray(v)){if(v[0]&&val.length<v[0])return _reasons.push("минимум "+v[0]+" "+self.h.declOfNum(v[0],["символ","символа","символов"])),range=!1,!1;if(v[1]&&val.length>v[1])return _reasons.push("максимум "+v[1]+" "+self.h.declOfNum(v[1],["символ","символа","символов"])),range=!1,!1}}),range?(_reasons=[],maxmin=!0,$.each(rule.exp,function(k,v){var match,reg;if(patterns[k]&&self.h.isArray(v)){if(reg=new RegExp("["+patterns[k].exp+"]","g"),match=val.match(reg),v[0]&&match&&match.length<v[0])return _reasons.push("минимум "+v[0]+" "+self.h.declOfNum(v[0],patterns[k].type)),maxmin=!1,!1;if(v[1]&&match&&match.length>v[1])return _reasons.push("максимум "+v[1]+" "+self.h.declOfNum(v[1],patterns[k].type)),maxmin=!1,!1}}),maxmin?obj:(reason=_reasons.join(", "),
rule.reason||(obj.reason="Требуется "+reason),obj.state=!1,obj)):(reason=_reasons.join(", "),rule.reason||(obj.reason="Требуется "+reason),obj.state=!1,obj)):(obj.state=!1,obj)})()}},Form}();