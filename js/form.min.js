var Form;Form=function(){function Form(params){var self;this.params=null!=params?params:{},self=this,this.logs=!1,this.formName=!1,this.formEl=!1,this.submitEl=!1,this.autoFields=!0,this.enter=!0,this.disableSubmit=!1,this.classes={disableSubmitClass:"disabled-submit",placeholderClass:"placeholder",errorFieldClass:"error-field",errorClass:"error-",preloaderClass:"preloader"},this.fields={},this.fieldsOptions={style:!0,focus:!1,clearErrorsInFocus:!0,autoErrors:!0,escape:!1,rules:{},onError:function(fieldName,errors){},onChange:function(callback){return this.el.on("change",function(e,v){return callback(v.val)})}},this.data={},this.errors={},this.onFail=function(errors){},this.onSuccess=function(data){},this.onSubmit=function(data){},this.onReset=function(){},this.onLoad=function(){},this.onInit=function(){},$.extend(!0,this,this.params),$(function(){return!self.formEl&&self.logs?console.log("[Form: "+self.formName+"] Warning! formEl not set"):!self.submitEl&&self.logs?console.log("[Form: "+self.formName+"] Warning! submitEl not set"):(self.form=self.isObject(self.formEl)?self.formEl:$(self.formEl),self.submitBtn=self.isObject(self.submitEl)?self.submitEl:self.form.find(self.submitEl),!self.form.size()&&self.logs?console.log("[Form: "+self.formName+"] Warning! formEl not found in DOM"):!self.submitBtn.size()&&self.logs?console.log("[Form: "+self.formName+"] Warning! submitEl not found in DOM"):(self.enter&&$(window).keydown(function(event){return self.form.inFocus&&13===event.keyCode&&!self.disableSubmit?self.submit():void 0}),self.autoFields&&self.form.find("[name]").each(function(){var name;return name=$(this).attr("name"),self.fields[name]=self.params.fields&&self.params.fields[name]?self.params.fields[name]:{}}),self.init(),void self.onLoad()))})}return Form.prototype.init=function(){var opts,self;self=this,this.form.unbind(),this.submitBtn.unbind(),this.form.submit(function(e){return e.preventDefault()}),this.form.mouseover(function(){return self.form.inFocus=!0}),this.form.mouseout(function(){return self.form.inFocus=!1}),this.params.disableSubmit&&this.lockSubmit(),this.submitBtn.click(function(){return self.disableSubmit||self.submit(),!1}),$.each(this.fields,function(name){return self.initField(name)}),opts={autoFields:this.autoFields,fields:this.fields,fieldsOptions:this.fieldsOptions,enter:this.enter,disableSubmit:this.disableSubmit,classes:this.classes},self.logs&&console.log("[Form: "+this.formName+"] init",opts),this.onInit()},Form.prototype.initField=function(name,isNew){var el,ref,ref1,self;return self=this,el=this.form.find("[name='"+name+"']"),el.size()?(this.fields[name]=$.extend(!0,{},this.fieldsOptions,this.fields[name]),this.fields[name].el=el,this.fields[name].sel=el,isNew&&(this.fields[name]["new"]=!0),this.fields[name].el.unbind(),this.fields[name].val=function(val){return val?void self.set(name,val):self.get(name)},this.fields[name].el.is("select")?(this.fields[name].type="select",this.fields[name].style&&(this.createSelect(name),this.fields[name].el.change(function(){return self.createSelect(name,!0)}))):"radio"===this.fields[name].el.attr("type")?(this.fields[name].type="radio",this.fields[name].style&&this.createRadio(name)):"checkbox"===this.fields[name].el.attr("type")?(this.fields[name].type="checkbox",this.fields[name].style&&this.createCheckbox(name)):this.fields[name].el.is("textarea")?this.fields[name].type="textarea":this.fields[name].type="text","checkbox"===(ref=this.fields[name].type)||"radio"===ref?this.fields[name].originVal=this.fields[name].el.filter(":checked").val()||!1:this.fields[name].originVal=this.fields[name].el.val(),!this.fields[name].placeholder||"text"!==(ref1=this.fields[name].type)&&"textarea"!==ref1||this.placeholder(this.fields[name].el,this.fields[name].placeholder),this.fields[name].focus&&this.fields[name].el.focus(),this.fields[name].el.removeClass(this.classes.errorFieldClass),this.fields[name].sel.removeClass(this.classes.errorFieldClass),this.fields[name].autoErrors&&this.form.find("."+this.classes.errorClass+name).empty(),void this.fields[name].sel.click(function(){return self.fields[name].clearErrorsInFocus&&(self.fields[name].el.removeClass(self.classes.errorFieldClass),self.fields[name].sel.removeClass(self.classes.errorFieldClass)),self.fields[name].autoErrors?self.form.find("."+self.classes.errorClass+name).empty():void 0})):void console.log("[Form: "+this.formName+"] Warning! selector '"+name+"' not found")},Form.prototype.addField=function(name,opt){null==opt&&(opt=this.fieldsOptions),this.fields[name]=opt,this.initField(name,!0),this.logs&&console.log("[Form: "+this.formName+"] add",name)},Form.prototype.removeField=function(name){this.fields[name].sel.remove(),this.fields[name].style&&this.fields[name].el.show(),this.logs&&console.log("[Form: "+this.formName+"] delete",name),delete this.fields[name]},Form.prototype.createCheckbox=function(name){var $checkbox,self,value;this.fields[name].el.hide(),value=this.fields[name].el.attr("value"),self=this,this.form.find(".checkbox[data-name="+name+"][data-value="+value+"]").size()&&this.form.find(".checkbox[data-name="+name+"][data-value="+value+"]").remove(),this.fields[name].el.click(function(){return $(this).is(":checked")?self.form.find(".checkbox[data-name="+name+"]").addClass("checked"):self.form.find(".checkbox[data-name="+name+"]").removeClass("checked")}),$checkbox=$("<div class='checkbox' data-name='"+name+"' data-value='"+value+"'></div>"),this.fields[name].el.attr("checked")&&$checkbox.addClass("checked"),this.fields[name].el.after($checkbox),this.fields[name].sel=$checkbox,$checkbox.click(function(){return self.fields[name].el.is(":checked")?($(this).removeClass("checked"),self.setVal(name,!1)):($(this).addClass("checked"),self.setVal(name,value))})},Form.prototype.createRadio=function(name){var self;self=this,this.fields[name].el.each(function(){var $radio,el,value;return el=$(this),el.hide(),value=el.attr("value"),self.form.find(".radio[data-name="+name+"][data-value="+value+"]").size()&&self.form.find(".radio[data-name="+name+"][data-value="+value+"]").remove(),el.click(function(){return self.form.find(".radio[data-name="+name+"]").removeClass("checked"),self.form.find(".radio[data-name="+name+"][data-value="+value+"]").addClass("checked")}),$radio=$("<div class='radio' data-name='"+name+"' data-value='"+value+"'></div>"),el.attr("checked")&&$radio.addClass("checked"),el.after($radio),self.fields[name].sel=self.form.find("[data-name='"+name+"']"),$radio.click(function(){return self.form.find(".radio[data-name="+name+"]").removeClass("checked"),$(this).addClass("checked"),self.setVal(name,value)})})},Form.prototype.createSelect=function(name,change){var $options,$select,$selected,emptyOption,selectClose,selectedText,self;return this.fields[name].el.hide(),self=this,change?(this.fields[name].sel.find(".selected").html(this.fields[name].el.val()),void(this.fields[name].el.val()!==this.fields[name].el.find("option:first-child").text()?this.fields[name].sel.find(".selected").removeClass("default"):this.fields[name].sel.find(".selected").addClass("default"))):(this.form.find(".select[data-name='"+name+"']").size()&&this.form.find(".select[data-name='"+name+"']").remove(),$select=$("<div class='select' data-name='"+name+"'></div>"),$options=$("<div class='options' style='display:none;'></div>"),selectedText=this.fields[name].el.find("option[selected]").size()?this.fields[name].el.find("option:selected").text():this.fields[name].el.find("option:first-child").text(),$selected=$("<div class='selected'>"+selectedText+"</div>"),this.fields[name].el.find("option:selected").is(":first-child")&&$selected.addClass("default"),emptyOption=this.fields[name].el.find("option").not("option[value]"),this.fields[name].rules.required&&emptyOption.size()&&("boolean"==typeof this.fields[name].rules.required?this.fields[name].rules={required:{not:this.trim(emptyOption.text())}}:this.fields[name].rules.required.not||(this.fields[name].rules.required.not=this.trim(emptyOption.text()))),$select.append($selected),$select.append($options),this.fields[name].el.after($select),this.fields[name].sel=$select,selectClose=!1,$select.mouseover(function(){return selectClose=!1}),$select.mouseout(function(){return selectClose=!0}),$(document).click(function(){return selectClose?($select.removeClass("open"),$options.hide()):void 0}),$selected.click(function(){return $select.hasClass("open")?($select.removeClass("open"),$options.hide()):($select.addClass("open"),$options.show())}),void this.fields[name].el.find("option").each(function(){var $option;return $option=$(this).attr("value")?$("<div class='option' data-value='"+$(this).attr("value")+"'><span>"+$(this).text()+"</span></div>"):$("<div class='option'><span>"+$(this).text()+"</span></div>"),$option.click(function(_this){return function(){return $(_this).attr("value")?(self.setVal(name,$(_this).attr("value")),$selected.removeClass("default")):(self.setVal(name,self.fields[name].originVal),$selected.addClass("default")),$select.find(".selected").html($(_this).text()),$select.removeClass("open"),$options.hide()}}(this)),$options.append($option)}))},Form.prototype.setVal=function(name,val){var opt,ref;opt=this.fields[name],"radio"===opt.type?(opt.el.prop("checked",!1),opt.el.filter("[value='"+val+"']").prop("checked",val)):"checkbox"===opt.type?opt.el.prop("checked",val):"select"===opt.type?opt.el.val(val):opt.el.val(this.trim(val)),!opt.placeholder||"text"!==(ref=opt.type)&&"textarea"!==ref||(""===val||val===opt.placeholder?this.placeholder(opt.el,opt.placeholder):opt.el.removeClass(this.classes.placeholderClass)),this.fields[name].el.trigger("change",[{name:name,val:val}])},Form.prototype.getVal=function(name){var opt,ref,val;return opt=this.fields[name],"checkbox"===(ref=opt.type)||"radio"===ref?val=opt.el.filter(":checked").val()||!1:"select"===opt.type?val=opt.el.val():(opt.el.val(this.trim(opt.el.val())),opt.escape&&opt.el.val(this.stripHTML(opt.el.val())),val=this.trim(opt.el.val()),opt.placeholder&&val===opt.placeholder&&(val="")),val},Form.prototype.set=function(name,val){var el,sel;null==val&&(val=!1),this.fields[name]&&(el=this.fields[name].el,sel=this.fields[name].sel,this.setVal(name,val),"select"===this.fields[name].type&&(val||(val=el.find("option").eq(0).val()),el.trigger("change")),"checkbox"===this.fields[name].type&&(val?sel.addClass("checked"):sel.removeClass("checked")),"radio"===this.fields[name].type&&(sel.removeClass("checked"),val?sel.filter("[data-value='"+val+"']").addClass("checked"):(val=el.eq(0).val(),sel.eq(0).addClass("checked"))))},Form.prototype.get=function(name){var val;return val=this.getVal(name)},Form.prototype.submit=function(){var self;self=this,this.resetData(),this.resetErorrs(),console.groupCollapsed("[Form: "+this.formName+"] submit"),$.each(this.fields,function(name,opt){var ref,results,rule,ruleName,val,valid;if(val=self.getVal(name),self.setData(name,val),self.logs&&console.log(name+": "+val),opt.el.removeClass(self.classes.errorFieldClass),opt.sel.removeClass(self.classes.errorFieldClass),opt.autoErrors&&self.form.find("."+self.classes.errorClass+name).empty(),!self.isEmpty(opt.rules)){ref=opt.rules,results=[];for(ruleName in ref)rule=ref[ruleName],valid=self.validate[ruleName](val,rule),valid.state?results.push(void 0):results.push(self.setError(name,valid.reason));return results}}),this.logs&&console.log("data",this.data),console.groupEnd(),this.onSubmit(this.data),this.isEmpty(this.errors)?this.success():this.fail()},Form.prototype.fail=function(){var self;self=this,console.groupCollapsed("[Form: "+this.formName+"] fail"),$.each(this.fields,function(name,opt){var error,i,ref;if(self.errors[name]){if(self.logs&&console.log(name+": ",self.errors[name]),opt.el.addClass(self.classes.errorFieldClass),opt.sel.addClass(self.classes.errorFieldClass),self.fields[name].autoErrors)if("all"===self.fields[name].autoErrors){ref=self.errors[name];for(i in ref)error=ref[i],self.form.find("."+self.classes.errorClass+name).append(error+"<br/>")}else self.form.find("."+self.classes.errorClass+name).html(self.errors[name][0]);return opt.onError(name,self.errors[name])}}),this.logs&&console.log("data",this.errors),console.groupEnd(),this.onFail(this.errors)},Form.prototype.success=function(){var name,ref,val;console.groupCollapsed("[Form: "+this.formName+"] success"),ref=this.data;for(name in ref)val=ref[name],this.logs&&console.log(name,val);this.logs&&console.log("data",this.data),console.groupEnd(),this.onSuccess(this.data)},Form.prototype.reset=function(){var self;self=this,this.resetData(),this.resetErorrs(),$.each(this.fields,function(name,opt){return self.setVal(name,opt.originVal),self.fields[name]["new"]?self.removeField(name):void 0}),this.logs&&console.log("[Form: "+this.formName+"] reset"),this.onReset(),this.init()},Form.prototype.resetErorrs=function(){return this.errors={}},Form.prototype.resetData=function(){return this.data={}},Form.prototype.setData=function(name,val){this.data[name]||(this.data[name]=val)},Form.prototype.getData=function(){return this.data},Form.prototype.setError=function(name,val){this.errors[name]||(this.errors[name]=[]),this.errors[name].push(val)},Form.prototype.getErrors=function(){return this.errors},Form.prototype.placeholder=function(el,val){el.focus(function(_this){return function(){return el.val()===val?el.val("").removeClass(_this.classes.placeholderClass):void 0}}(this)).blur(function(_this){return function(){return""===el.val()?el.val(val).addClass(_this.classes.placeholderClass):void 0}}(this)),el.blur()},Form.prototype.lockSubmit=function(){this.disableSubmit=!0,this.submitBtn.addClass(this.classes.disableSubmitClass)},Form.prototype.unlockSubmit=function(){this.disableSubmit=!1,this.submitBtn.removeClass(this.classes.disableSubmitClass)},Form.prototype.showPreloader=function(){this.form.find("."+this.classes.preloaderClass).show()},Form.prototype.hidePreloader=function(){this.form.find("."+this.classes.preloaderClass).hide()},Form.prototype.validate={isFunction:function(obj){return"[object Function]"===Object.prototype.toString.call(obj)},declOfNum:function(number,titles){var cases;return cases=[2,0,1,1,1,2],titles[number%100>4&&20>number%100?2:cases[5>number%10?number%10:5]]},required:function(val,rule){var valid;return valid={state:""!==val&&val!==!1&&val!==rule.not,reason:rule.reason||"Обязательное поле для заполнения"}},numeric:function(val,rule){var valid;return valid={state:/^[0-9]+$/.test(val)||""===val,reason:rule.reason||"Допустимы только цифры"}},numericDash:function(val,rule){var valid;return valid={state:/^[\d\-\s]+$/.test(val)||""===val,reason:rule.reason||"Допустимы только цифры и подчеркивания"}},alpha:function(val,rule){var valid;return valid={state:/^[a-zа-я]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только буквы"}},eng:function(val,rule){var valid;return valid={state:/^[a-z]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только английские буквы"}},cyrillic:function(val,rule){var valid;return valid={state:/^[а-я]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только русские буквы"}},alphaDash:function(val,rule){var valid;return valid={state:/^[a-z0-9_\-]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только буквы и подчеркивания"}},alphaNumeric:function(val,rule){var valid;return valid={state:/^[a-z0-9]+$/i.test(val)||""===val,reason:rule.reason||"Допустимы только буквы и цифры"}},max:function(val,rule){var valid;return rule.reason&&(rule.reason=rule.reason.replace(/\{count\}/g,rule.count)),valid={state:val.length<=rule.count||""===val,reason:rule.reason||"Максимум "+rule.count+" "+this.declOfNum(rule.count,["символ","символа","символов"])}},min:function(val,rule){var valid;return rule.reason&&(rule.reason=rule.reason.replace(/\{count\}/g,rule.count)),valid={state:val.length>=rule.count||""===val,reason:rule.reason||"Минимум "+rule.count+" "+this.declOfNum(rule.count,["символ","символа","символов"])}},email:function(val,rule){var valid;return valid={state:/^[a-zA-Z0-9.!#$%&amp;'*+\-\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/.test(val)||""===val,reason:rule.reason||"Неправильно заполненный E-mail"}},url:function(val,rule){var valid;return valid={state:/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(val)||""===val,reason:rule.reason||"Неправильно заполненный url"}},compare:function(val,rule){var valid;return valid={state:val===(this.isFunction(rule.val)?rule.val():rule.val),reason:rule.reason||"Поля не совпадают"}}},Form.prototype.addRule=function(opt){return this.fields[opt.field].rules[opt.rule]=opt.reason,this.validate[opt.rule]=function(val,args,description){var valid;return valid={state:opt.condition(val)||""===val,reason:opt.reason||"custom reason"}}},Form.prototype.log=function(){var argument,formName,j,len,newArgs;if(console&&this.logs){for(formName=this.formName||this.formEl,newArgs=["[Form]","'"+formName+"'"],j=0,len=arguments.length;len>j;j++)argument=arguments[j],newArgs.push(argument);return console.log.apply(console,newArgs)}},Form.prototype.trim=function(text){return null==text&&(text=""),text.replace(/^\s+|\s+$/g,"")},Form.prototype.stripHTML=function(text){return null==text&&(text=""),text.replace(/<(?:.|\s)*?>/g,"")},Form.prototype.isString=function(obj){return"[object String]"===Object.prototype.toString.call(obj)},Form.prototype.isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},Form.prototype.isObject=function(obj){return"[object Object]"===Object.prototype.toString.call(obj)},Form.prototype.isEmpty=function(o){var i;if(this.isString(o))return""===this.trim(o)?!0:!1;if(this.isArray(o))return 0===o.length?!0:!1;if(this.isObject(o)){for(i in o)if(o.hasOwnProperty(i))return!1;return!0}},Form}();